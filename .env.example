# =============================================================================
# 歌词混剪系统环境变量配置示例
# =============================================================================
# 说明：复制此文件为 .env 并填入真实值

# -----------------------------------------------------------------------------
# TwelveLabs API 配置
# -----------------------------------------------------------------------------
# TwelveLabs API 密钥（必需）
TL_API_KEY=tlk_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# TwelveLabs 索引 ID（必需）
# 重要：索引在创建时已配置了引擎和模态（model_options）
# 搜索时的 search_options 必须是索引 model_options 的子集
# 参考：https://docs.twelvelabs.io/v1.3/api-reference/indexes/create
TL_INDEX_ID=6911aaadd68fb776bc1bd8e7

# -----------------------------------------------------------------------------
# 搜索模态配置（Search Options）
# -----------------------------------------------------------------------------
# 核心概念：
# - model_options: 索引创建时配置，决定了哪些模态被索引（不可修改）
# - search_options: 搜索时配置，必须是 model_options 的子集
#
# 重要：启用下列选项前，请确认您的索引支持对应模态
# 如果 search_options 包含索引不支持的模态，搜索可能失败
# 使用 `python scripts/dev/verify_config.py` 验证配置

# 是否启用 audio 模态搜索（可选，默认 false）
# 前提：索引创建时的 model_options 包含 "audio"
# - Marengo 3.0 索引: audio 模态搜索非语音音频（音乐、环境声、警报等）
# - Marengo 2.7 索引: audio 模态搜索所有音频（包含语音+非语音）
TL_AUDIO_SEARCH_ENABLED=false

# 是否启用 transcription 模态搜索（可选，默认 false）
# 前提：索引必须是 Marengo 3.0 引擎且 model_options 包含 "transcription"
# 注意：如果索引不支持 transcription，搜索会失败
TL_TRANSCRIPTION_SEARCH_ENABLED=false

# -----------------------------------------------------------------------------
# 高级搜索选项
# -----------------------------------------------------------------------------
# Transcription 搜索模式（可选，默认 semantic）
# 仅当启用 transcription 模态时有效（需要 Marengo 3.0 索引）
# - lexical: 关键词精确匹配（适合产品名称、专业术语）
# - semantic: 语义匹配（理解含义，即使措辞不同）
# - both: 两者都用（返回最广泛的结果）
TL_TRANSCRIPTION_MODE=semantic

# 多模态组合方式（可选，默认 or）
# 当启用多个搜索模态时，决定如何组合结果
# - or: 返回匹配任意模态的结果
# - and: 返回同时匹配所有模态的结果
TL_SEARCH_OPERATOR=or

# 置信度阈值（可选，默认 0.0，范围 0.0-1.0）
# 调整搜索结果置信度的判定阈值
# 较低的值使阈值更宽松，允许更多结果被分类为高/中/低置信度
TL_CONFIDENCE_THRESHOLD=0.0

# -----------------------------------------------------------------------------
# AI 查询改写配置
# -----------------------------------------------------------------------------
# DeepSeek API 密钥（可选，用于改写抽象歌词为具体视觉描述）
DEEPSEEK_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# DeepSeek API 地址（可选，默认 https://api.deepseek.com/v1）
DEEPSEEK_BASE_URL=https://api.deepseek.com/v1

# 是否启用查询改写（可选，默认 true）
QUERY_REWRITE_ENABLED=true

# 是否强制改写（可选，默认 false）
# - true: 第一次查询就改写歌词为视觉描述，不再尝试原始歌词
# - false: 先用原始歌词查询，无结果时才改写（节省 AI 调用）
# 推荐：如果歌词多为抽象表达，建议设为 true 提高匹配精度
QUERY_REWRITE_MANDATORY=false

# 查询改写最大重试次数（可选，默认 3）
# 当改写后仍无匹配时，会自动使用不同策略重新改写
# 策略演进：具体描述 → 通用场景 → 极简关键词
QUERY_REWRITE_MAX_ATTEMPTS=3

# -----------------------------------------------------------------------------
# 数据库配置
# -----------------------------------------------------------------------------
# PostgreSQL 连接 URL（必需）
POSTGRES_DSN=postgresql+asyncpg://user:password@localhost:5432/lyrics_mix

# -----------------------------------------------------------------------------
# Redis 配置
# -----------------------------------------------------------------------------
# Redis 连接 URL（必需，用于 Arq worker 队列）
REDIS_URL=redis://localhost:6379/0

# -----------------------------------------------------------------------------
# 媒资配置
# -----------------------------------------------------------------------------
# Fallback 视频 ID（当 TwelveLabs 无命中时使用，必需）
FALLBACK_VIDEO_ID=6911acda8bf751b791733149

# 媒资根目录（可选，默认为 ./media）
MEDIA_ROOT=/path/to/media

# -----------------------------------------------------------------------------
# 对象存储配置（MinIO/S3）
# -----------------------------------------------------------------------------
# MinIO/S3 endpoint（可选，未配置时产物仅存本地）
MINIO_ENDPOINT=localhost:9000

# MinIO/S3 访问密钥（可选）
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin

# MinIO/S3 bucket 名称（可选）
MINIO_BUCKET=lyrics-mix-output

# 是否使用 HTTPS（可选，默认 false）
MINIO_USE_SSL=false

# -----------------------------------------------------------------------------
# Worker 配置
# -----------------------------------------------------------------------------
# 是否启用异步队列（可选，默认 true）
# 设为 false 时 API 将同步执行任务，仅用于本地调试
ENABLE_ASYNC_QUEUE=true

# 渲染并发数（可选，默认 3）
RENDER_CONCURRENCY=3

# 并行裁剪最大并发槽位（可选，默认 10，用于 clip 级 TaskGroup）
RENDER_CLIP_CONCURRENCY=10

# RenderClipConfig 热加载所使用的 Redis Pub/Sub 频道名称
RENDER_CONFIG_CHANNEL=render:config

# 占位片段素材路径（H.264 + AAC，默认 media/fallback/clip_placeholder.mp4）
PLACEHOLDER_CLIP_PATH=media/fallback/clip_placeholder.mp4

# -----------------------------------------------------------------------------
# 可观测性配置
# -----------------------------------------------------------------------------
# OTEL Exporter endpoint（可选）
OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4317

# 日志级别（可选，默认 INFO）
LOG_LEVEL=INFO

# structlog 日志格式（可选，默认 json）
LOG_FORMAT=json

# -----------------------------------------------------------------------------
# API 配置
# -----------------------------------------------------------------------------
# API 端口（可选，默认 8080）
API_PORT=8080

# API 访问域名（可选，用于生成完整 URL）
API_DOMAIN=http://localhost:8080
